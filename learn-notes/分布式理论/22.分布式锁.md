# 分布式锁
## zookeeper实现分布式锁
[!原理图](./assets/zk_lock.png)
1. 在获取分布式锁的时候在locker节点下创建临时顺序节点，释放锁的时候删除该临时节点。
2. 客户端调createNode方法在locks下创建临时顺序节点，然后调用getChildren("locks"")来获取locks下面的所有子节点，注意此时不用设置任何Watcher。
3. 客户端获取到所有的子节点path之后，如果发现自己创建的子节点序号最小，那么就认为该客户端获取都了锁。
4. 如果发现自己创建的节点并非locks所有子节点中最小的，说明自己还没有获取到锁，此时客户端需要找到比自己小的那个节点，然后对其调用exist()方法，同事对其注册时间监听器。
5. 之后，让这个被关注的节点删除，则客户端的Watcher会收到相应通知，此时再次判断自己创建的节点是否是locks子节点中序号最小的，如果是则获取到了锁，如果不是则重复以上步骤继续获取到比自己小的一个节点并注册监听。

[!监听锁原理图](./assets/zk_lock1.png)



### 参考文章
https://www.cnblogs.com/flgb/p/10549215.html



## redis分布式锁
